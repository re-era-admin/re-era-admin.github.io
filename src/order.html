<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./common/css/common.css" />
    <link rel="stylesheet" href="./css/order.css" />
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-firestore.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.js"
      integrity="sha256-DrT5NfxfbHvMHux31Lkhxg42LY6of8TaYyK50jnxRnM="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.9.2/parsley.min.js"
      integrity="sha512-eyHL1atYNycXNXZMDndxrDhNAegH2BDWt1TmkXJPoGf1WLlNYt08CSjkqF5lnCRmdm3IrkHid8s2jOUY4NIZVQ=="
      crossorigin="anonymous"
    ></script>
    <title>オンライン横丁 flatto -出店申請フォーム-</title>
  </head>
  <body>
    <!-- Scrolls -->
    <div id="main">
      <div class="containers container_form">
        <div class="area area_pageTitle">
          <div class="part">
            <h1 id="inputForm_title">出店申請フォーム</h1>
            <h1 id="comfirmForm_title">出店申請確認画面</h1>
          </div>
        </div>
        <div class="area" id="area_inputForm">
          <form
            id="orderForm"
            action="./acceptOffer.html"
            　data-parsley-trigger="keyup focusout change input"
          >
            <div class="part">
              <p>出店名[30文字まで]*</p>
              <input
                id="bar_name"
                required
                data-parsley-openDate
                maxlength="30"
                placeholder="(例)居酒屋 flatto"
                data-parsley-error-message="必須項目です。"
              />
            </div>
            <div class="part">
              <p>チケット購入形態*</p>
              <select id="ticket_pattern">
                <option value="1">予約先着型</option>
                <option value="2">ふらっと型</option>
                <option value="3">抽選型</option>
              </select>
            </div>
            <div class="part">
              <p>トークジャンル[50文字まで]*</p>
              <input
                id="talk_genre"
                required
                placeholder="(例)雑談"
                data-parsley-error-message="必須項目です。"
              />
            </div>
            <div class="part">
              <p>お店の説明*</p>
              <textarea
                id="description"
                required
                data-parsley-error-message="必須項目です。"
              ></textarea>
            </div>
            <div class="part">
              <p>お店の説明要約1[20文字]</p>
              <input id="description_outline1" maxlength="20" />
            </div>
            <div class="part">
              <p>お店の説明要約2[20文字]</p>
              <input id="description_outline2" maxlength="20" />
            </div>
            <div class="part">
              <p>お店の説明要約3[20文字]</p>
              <input id="description_outline3" maxlength="20" />
            </div>
            <div class="part">
              <p>お客様席数 (店主様分はこの中に含みません)*</p>
              <select id="seats">
                <option value="4">4</option>
                <option value="3">3</option>
                <option value="2">2</option>
                <option value="1">1</option>
              </select>
            </div>
            <div class="part">
              <p>チケット価格(円) 0も設定可能*</p>
              <input
                id="price"
                placeholder="(例)5000"
                required
                data-parsley-type="integer"
                data-parsley-error-message="チケット価格を数字で入力してください。"
              />
            </div>
            <div class="part">
              <p>
                チケットの単位時間(分) [30分以上〜]*<br />
                ※お客様が滞在できる時間です。
              </p>
              <input
                id="unit_time"
                required
                data-parsley-type="integer"
                data-parsley-min="30"
                data-parsley-error-message="チケット単位時間は30以上の数字を設定してください。"
              />
            </div>
            <div class="part">
              <p>お店の開店時間(現在時刻よりも10分後以降)*</p>
              <input
                id="start_time"
                type="datetime-local"
                required
                data-parsley-openDate=""
                data-parsley-error-message="必須項目です。"
              />
            </div>
            <div class="part">
              <p>開催時間(30分-240分)*</p>
              <input
                id="duration"
                data-parsley-type="integer"
                data-parsley-min="30"
                data-parsley-max="240"
                data-parsley-openDate
                data-parsley-error-message="開催時間は30以上240以下の数字を設定してください。"
              />分
            </div>
            <div class="part">
              <button type="button" id="check_btn">確認画面へ</button>
              <input type="submit" id="submit" value="申請する" />
              <button type="button" id="remake_btn">申請内容を修正する</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAcahSSBT9jzNddDlvPLMLIsUFSsagmN4g",
        authDomain: "flatto-yokocho.firebaseapp.com",
        databaseURL: "https://flatto-yokocho.firebaseio.com",
        projectId: "flatto-yokocho",
        storageBucket: "flatto-yokocho.appspot.com",
        messagingSenderId: "699983020092",
        appId: "1:699983020092:web:d29c1bd9f1b62817904339",
        measurementId: "G-7J94N3VHRE",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      window.onload = function () {
        firebase.auth().onAuthStateChanged(function (user) {
          if (user) {
          } else {
            location.href = "./login.html";
          }
        });
      };
      $("#orderForm").parsley();
      function test() {
        $("#orderForm").parsley().validate();
      }
      document.getElementById("check_btn").addEventListener(
        "click",
        function (event) {
          $("#orderForm").parsley().validate();
          event.preventDefault();
        },
        false
      );
      document.getElementById("remake_btn").addEventListener(
        "click",
        function (event) {
          switchInputForm();
          event.preventDefault();
        },
        false
      );
      $("#orderForm")
        .parsley()
        .on("form:success", function () {
          nowDate = new Date();
          var time = document.getElementById("start_time").value;
          time = time.toString();
          inputDate = new Date(time);
          var error_message = "";
          if (nowDate.setMinutes(nowDate.getMinutes() + 10) > inputDate) {
            error_message =
              error_message +
              "お店の開店時間は今から10分以上後にして下さい。\n";
          }
          if (
            document.getElementById("unit_time").value >
            document.getElementById("duration").value
          ) {
            error_message =
              error_message +
              "チケット単位時間は開催時間以内に設定して下さい。\n";
          }
          if (error_message == "") {
            switchComfirmForm();
          } else {
            alert(error_message);
          }
        });

      function switchInputForm() {
        document.getElementById("bar_name").disabled = false;
        document.getElementById("ticket_pattern").disabled = false;
        document.getElementById("talk_genre").disabled = false;
        document.getElementById("description").disabled = false;
        document.getElementById("description_outline1").disabled = false;
        document.getElementById("description_outline2").disabled = false;
        document.getElementById("description_outline3").disabled = false;
        document.getElementById("seats").disabled = false;
        document.getElementById("price").disabled = false;
        document.getElementById("unit_time").disabled = false;
        document.getElementById("start_time").disabled = false;
        document.getElementById("duration").disabled = false;

        document.getElementById("check_btn").style.display = "block";
        document.getElementById("submit").style.display = "none";
        document.getElementById("remake_btn").style.display = "none";
        document.getElementById("inputForm_title").style.display = "block";
        document.getElementById("comfirmForm_title").style.display = "none";
      }

      function switchComfirmForm() {
        document.getElementById("bar_name").disabled = true;
        document.getElementById("ticket_pattern").disabled = true;
        document.getElementById("talk_genre").disabled = true;
        document.getElementById("description").disabled = true;
        document.getElementById("description_outline1").disabled = true;
        document.getElementById("description_outline2").disabled = true;
        document.getElementById("description_outline3").disabled = true;
        document.getElementById("seats").disabled = true;
        document.getElementById("price").disabled = true;
        document.getElementById("unit_time").disabled = true;
        document.getElementById("start_time").disabled = true;
        document.getElementById("duration").disabled = true;

        document.getElementById("check_btn").style.display = "none";
        document.getElementById("submit").style.display = "block";
        document.getElementById("remake_btn").style.display = "block";
        document.getElementById("inputForm_title").style.display = "none";
        document.getElementById("comfirmForm_title").style.display = "block";
        document.getElementById("main").style.backgroundColor = "#ddd";
      }
    </script>
  </body>
</html>
